pkgname=servus-utils
pkgver="0.0.18"
pkgrel=1
pkgbranch=master
pkgdesc='servus-utils'
pkgsrc=servus-extapi
arch=('x86_64' 'armv7h' 'aarch64')
url='https://github.com/DictumMortuum/servus-extapi'
license=(APACHE)
makedepends=(go jq)
source=("${pkgsrc}.tar.gz::${url}/archive/refs/heads/${pkgbranch}.tar.gz")
sha256sums=('SKIP')

pkgver() {
  cd "$srcdir/$pkgsrc-$pkgbranch"
  jq '.version' version.json
}

build() {
  cd "$srcdir/$pkgsrc-$pkgbranch"
  export GOARCH="$ARCH"
  make servus-magissa
  make servus-nauagio
  make servus-modem-a
  make servus-modem-d
  make servus-modem-restart-a
}

package() {
  cd "$srcdir/$pkgsrc-$pkgbranch/dist"
  install -Dm755 servus-magissa "$pkgdir/usr/local/bin/magissa"
  install -Dm755 servus-nauagio "$pkgdir/usr/local/bin/nauagio"
  install -Dm755 servus-modem-a "$pkgdir/usr/local/bin/scsa"
  install -Dm755 servus-modem-d "$pkgdir/usr/local/bin/scsd"
  install -Dm755 servus-modem-restart-a "$pkgdir/usr/local/bin/srr"
}
